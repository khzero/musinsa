# 무신사 Backend Engineer 과제

## 구현 범위 및 설명

- 과제1) 카테고리 별 최저 가격 브랜드와 상품 가격, 총액을 조회하는 API
  - Querydsl을 활용해서 조회 하도록 했습니다.
  - 상품의 개수가 많아질 경우, 메모리의 문제가 발생할 수 있어 쿼리를 최적화 하였습니다. 
  - 동일 브랜드, 동일 카테고리이며 가격이 다른 상품이 있을 수 있으므로, 가격이 가장 저렴한 상품을 조회하도록 했습니다.
  - 가격까지 동일한 상품이 여러개 있을 경우, 최근 등록된 상품이 조회되도록 하였습니다.
  - 특정 카테고리에 같은 브랜드의 더 저렴한 상품이 추가되면 해당 카테고리가 최저가의 브랜드 상품으로 조회되도록 했습니다.
  - 특정 카테고리의 최저가 상품을 제거하면 최저가 상품이 갱신될 수 있도록 하였습니다.
  - 상품을 삭제하여 카테고리중 하나라도 상품이 등록되지 않은 카테고리가 있다면 에러가 발생하도록 하였습니다.
- 과제2) 단일 브랜드로 모든 카테고리 상품을 구매할 때 최저가격에 판매하는 브랜드와 카테고리의 상품가격, 총액을 조회하는 API
  - 카테고리와 브랜드를 그룹화 하였을때 상품의 최저가를 가져오도록 하여, 조회 대상을 축소하였습니다.
  - 브랜드 단위로 그룹핑 하여, 모든 카테고리를 가지고 있는 브랜드만 필터링하고, 모든 브랜드가 각 카테고리의 상품을 가지고 있지 않을 경우 에러가 발생하도록 하였습니다.
  - 상품이 삭제되어 카테고리가 모두 존재하지 않는 브랜드의 경우 조회되지 않도록 했습니다.
  - 동일 브랜드, 동일 카테고리이며 가격이 다른 상품이 추가되더라도, 가격이 가장 저렴한 상품을 조회하도록 했습니다.
- 과제3) 카테고리 이름으로 최저, 최고 가격 브랜드와 상품 가격을 조회하는 API
  - 현재 데이터 규모에서는 카테고리 이름으로 조회하더라도 성능상 큰 문제가 없다고 판단하여, 별도 필드나 테이블을 구성하지 않았습니다.
  - 존재하지 않는 카테고리명으로 검색시 에러가 발생하도록 하였습니다.
  - 카테고리의 최저가와 최고가는 여러개의 상품이 해당될 수 있기 때문에, 여러개를 리턴할 수 있도록 하였습니다.
  - 카테고리에 등록된 상품이 없으면 에러가 발생 하도록 하였습니다.
- 과제4) 브랜드 및 상품을 추가 / 업데이트 / 삭제하는 API
  - 현재 요구사항 기준으로는 단순한 쿼리들만 존재하여 JPA ORM을 사용하여 구현하였습니다.
  - 상품 추가/수정시 Category 파라미터의 경우 변경 가능성이 높은 한글 이름보다 코드로 관리하는것이 더 효율적이라고 판단하여 코드로 관리하도록 했습니다.
  - 상품 추가 API에서는 카테고리 코드를 입력 받아 카테고리가 존재하지 않을 경우 상품이 추가되지 않도록 했습니다.
  - 상품 수정 API에서는 상품이 존재하지 않을 경우 404를 반환하도록 했습니다.
  - 상품 수정 API에서 요청 받은 필드만 수정하도록 했습니다.(null이 아닌 필드만 수정)
    - 이때 HTTP METHOD는 PUT 보다는 PATCH가 더 적합하지만, 대부분 PUT으로 요청을 보내기 때문에 PUT으로 구현하였습니다.
  - 상품 삭제 API에서는 상품이 존재하지 않을 경우 404를 반환하도록 했습니다.
  - 브랜드가 삭제 되면, 해당 브랜드에 존재 하는 모든 상품을 제거하도록 처리 하였습니다.

## 코드 빌드 및 실행

### Build
```shell
./gradlew clean build
```

### Run
```shell
./gradlew bootRun
```

## 테스트

### 카테고리 별 최저가격 브랜드와 상품 가격, 총액을 조회하는 API
GET http://localhost:5001/api/v1/products/lowest-price

### 단일 브랜드로 모든 카테고리 상품을 구매할 때 최저가격에 판매하는 브랜드와 카테고리의 상품가격, 총액을 조회하는 API
GET http://localhost:5001/api/v1/products/lowest-brand

### 카테고리 이름으로 최저, 최고 가격 브랜드와 상품 가격을 조회하는 API
GET http://localhost:5001/api/v1/products/category

### 브랜드 등록
POST http://localhost:5001/api/v1/brands

Content-Type: application/json

```json
{"name": "뉴진스"}
```

### 브랜드 수정
PUT http://localhost:5001/api/v1/brands/{id}

Content-Type: application/json
```json
{"name": "아일릿"}
```

### 브랜드 삭제
DELETE http://localhost:5001/api/v1/brands/{id}

### 상품 등록
POST http://localhost:5001/api/v1/products

Content-Type: application/json

```json
{"price": 10000, "brand_id": 1, "category": "TOP"}
```

### 상품 수정
PUT http://localhost:5001/api/v1/products/{id}

Content-Type: application/json
```json
{"price": 12000, "brand_id": 1, "category": "TOP"}
```
### 상품 삭제
DELETE http://localhost:5001/api/v1/products/{id}

## 기타 추가 정보

### 개선 가능한 부분
#### 캐시
매번 쿼리를 실행 하는것과 연산 처리를 하는것보다 캐시를 도입하여 응답속도를 개선할 수 있습니다.

#### 통계 테이블 구현
상품의 수가 많아지게 되면, 매번 복잡한 쿼리를 실행하는것이 아닌 별도의 테이블을 추가하여<br/>
상품 등록/수정/삭제와 같은 동작이 완료된 후 각 브랜드의 분류별 최저가격을 미리 계산해두는 방식을 도입할 수 있습니다.